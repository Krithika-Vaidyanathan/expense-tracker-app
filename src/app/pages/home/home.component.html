<!-- ==========================
     HOME PAGE
========================== -->
<div class="home-container px-4 sm:px-8 flex flex-col gap-y-8 w-full">

  <!-- Greeting Section -->
  <h1
    class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold text-center md:text-left leading-tight mt-4 sm:mt-6">
    Welcome back,
    <span class="text-customHsl-accent block sm:inline">
      {{ userService.getUser().name }}
    </span>
  </h1>

  <!-- Budget & Expense Forms -->
  <div class="input-container flex flex-col lg:flex-row w-full gap-6 lg:gap-8 mt-4 sm:mt-6">
    <!-- Budget Form -->
    <app-form-wrapper [formGroup]="budgetForm" class="w-full lg:w-1/2">
      <div class="input-form flex flex-col gap-y-4">
        <h3 class="font-bold text-xl sm:text-2xl">Create Budget</h3>

        <!-- Budget Name -->
        <div class="text-inputs flex flex-col gap-y-2">
          <label class="text-[17px] sm:text-[19px] font-bold">Budget Name</label>
          <input formControlName="name" type="text" class="input-select" placeholder="Budget name" />
        </div>

        <!-- Amount -->
        <div class="text-inputs flex flex-col gap-y-2">
          <label class="text-[17px] sm:text-[19px] font-bold">Amount</label>
          <input formControlName="budget" type="number" class="input-select" placeholder="e.g $120" />
        </div>

        <!-- Create Button -->
        <button [disabled]="budgetForm.invalid" (click)="addBudget()"
          class="btn bg-customHsl-text text-white border-none w-fit text-[17px] sm:text-[19px] flex items-center gap-2 px-6 py-3 rounded-md disabled:opacity-50 transition-all hover:bg-opacity-90">
          Create Budget
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="20" height="20" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z" clip-rule="evenodd"></path></svg>
        </button>
      </div>
    </app-form-wrapper>

    <!-- Expense Form -->
    <app-form-wrapper [formGroup]="expenseForm" class="w-full lg:w-1/2">
      <div class="input-form flex flex-col gap-y-4">
        <h3 class="font-bold text-xl sm:text-2xl">Add new Expense</h3>

        <!-- Expense Name + Amount -->
        <div class="text-input-container flex flex-col sm:flex-row gap-y-4 sm:gap-x-6">
          <div class="text-inputs flex flex-col gap-y-2 w-full sm:w-1/2">
            <label class="text-[17px] sm:text-[19px] font-bold">Expense Name</label>
            <input formControlName="name" type="text" class="input-select" placeholder="e.g Coffee" />
          </div>

          <div class="text-inputs flex flex-col gap-y-2 w-full sm:w-1/2">
            <label class="text-[17px] sm:text-[19px] font-bold">Amount</label>
            <input formControlName="amount" type="number" class="input-select" placeholder="e.g $120" />
          </div>
        </div>

        <!-- Category -->
        <div class="text-inputs flex flex-col gap-y-2">
          <label class="text-[17px] sm:text-[19px] font-bold">Budget Category</label>
          <select formControlName="budgetCategoryId" class="input-select">
            @for (item of budgetCategories; track $index) {
            <option value="{{ item.id }}">{{ item.name }}</option>
            }
          </select>
        </div>

        <!-- Add Expense -->
        <button [disabled]="expenseForm.invalid" (click)="addExpense()"
          class="btn bg-customHsl-text text-white border-none w-fit text-[17px] sm:text-[19px] flex items-center gap-2 px-6 py-3 rounded-md hover:bg-opacity-90 transition-all">
          Add Expense
          <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" width="20" height="20" viewBox="0 0 24 24">
            <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 9a.75.75 0 00-1.5 0v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9z" clip-rule="evenodd"></path></svg>
        </button>
      </div>
    </app-form-wrapper>

    <!-- Popup -->
    <app-popup [visible]="showPopup" [message]="popupMessage" (close)="showPopup = false"></app-popup>
  </div>

  <!-- Chart Section -->
  @if (chartPayload.meta.totalSpent && chartPayload.meta.totalSpent > 0) {
  <app-bar-chart [chartData]="chartPayload" [exportData]="expensesData"></app-bar-chart>
  }

  <!-- Existing Budgets -->
  @if (budgetCards && budgetCards.length > 0) {
  <h2 class="mini-title text-3xl sm:text-4xl md:text-5xl text-center md:text-left">
    Existing Budgets
  </h2>
  
  <div class="flex flex-wrap gap-4 justify-center md:justify-start w-full">
    @for (item of budgetCards; track $index) {
    <app-budget-card class="budget-card w-full sm:w-[48%] md:w-[31%]" [config]="item"></app-budget-card>
    }
  </div>
  }
  
  <!-- ==========================
       RECENT EXPENSES (Desktop only)
  ========================== -->
  @if (expenseTableData && expenseTableData.length > 0) {
  <div class="hidden lg:block mt-10">
    <h2 class="mini-title text-3xl sm:text-4xl md:text-5xl text-center md:text-left mb-6">
      Recent Expenses
    </h2>
  
    <app-table (removeRow)="handleDelete($event)" [data]="expenseTableData">
    </app-table>
  </div>
  }
